function Rect(b,d,c,a){this.x=b;this.y=d;this.width=c;this.height=a;this.Reset();this.x=-1;this.y=-1;this.width=-1;this.height=-1;this.Union=function(g){var f=this.x==-1?g.x:Math.min(this.x,g.x);var e=this.y==-1?g.y:Math.min(this.y,g.y);this.width=Math.max(this.x+this.width,g.x+g.width)-f;this.height=Math.max(this.y+this.height,g.y+g.height)-e;this.x=f;this.y=e}}function Drawing(){this.Rect=null;this.Dragable=false;this.IsDragging=false;this.FillColor="#44FF44";this.IsDirty=false;this.OnClick=function(a){}}function Layer(b,g,c,a){var e=[];var d=new Rect(-1,-1,-1,-1);var f=new Rect(-1,-1,-1,-1);this.Add=function(h){e.push(h)};this.Remove=function(h){};this.IsCurrent=function(i,h){};this.OnClick=function(h){}}function Screen(){if(Screen.prototype.singleton){return Screen.prototype.singleton}Screen.prototype.singleton=this;this.width=0;this.height=0;var c=document.getElementById("screen");var b=c.getContext("2d");Screen.prototype.bufferCanvas=document.createElement("canvas");Screen.prototype.MAX_CWIDTH=4096;Screen.prototype.MAX_CHEIGHT=4096;Screen.prototype.bufferCanvas.width=Screen.prototype.MAX_CWIDTH;Screen.prototype.bufferCanvas.height=Screen.prototype.MAX_CHEIGHT;Screen.prototype.bufferContext=Screen.prototype.bufferCanvas.getContext("2d");var n=false;var l,k;var m=0;var j=0;var a=0;var i=[];this.RegisterEvent=function(){$(window).on("resize",function(){Screen.prototype.singleton.Resize()});c.onmousedown=p;c.onmouseup=o;c.onmousemove=g};var h=function(s){for(var r=i.length-1;r>0;r--){var q=i[r];if(q.IsCurrent(s.pageX,s.pageY)){q.OnClick(s)}}d()};var p=function(u){u.preventDefault();u.stopPropagation();a=1;var v=parseInt(u.clientX-m);var t=parseInt(u.clientY-j);console.log("onDown  x="+v+",y="+t);n=false;for(var q=0;q<drawings.length;q++){var s=drawings[q];if(v>s.x&&v<s.x+s.width&&t>s.y&&t<s.y+s.height){n=true;s.isDragging=true}}l=v;k=t};var o=function(r){r.preventDefault();r.stopPropagation();console.log("OnUp");if(a==1){a=0;h(r)}n=false;for(var q=0;q<drawings.length;q++){drawings[q].isDragging=false}};var g=function(w){if(a==1){a=0}if(n){w.preventDefault();w.stopPropagation();var x=parseInt(w.clientX-m);var v=parseInt(w.clientY-j);console.log("OnMove  x="+x+",y="+v);var s=x-l;var q=v-k;for(var t=0;t<drawings.length;t++){var u=drawings[t];if(u.isDragging){u.x+=s;u.y+=q}}d();l=x;k=v}};var f=function(q,t,r,s){bufferContext.clearRect(q,t,r,s);b.clearRect(q,t,r,s)};var d=function(){f(0,0,Screen.prototype.singleton.width,Screen.prototype.singleton.height);for(var q=0;q<drawings.length;q++){var s=drawings[q];bufferContext.fillStyle=s.fill;bufferContext.beginPath();bufferContext.rect(s.x,s.y,s.width,s.height);bufferContext.closePath();bufferContext.fill()}e(0,0,Screen.prototype.singleton.width,Screen.prototype.singleton.height)};var e=function(q,t,r,s){b.drawImage(bufferCanvas,q,t,r,s,q,t,r,s)};this.Resize=function(){this.width=window.innerWidth;this.height=window.innerHeight;c.width=this.width;c.height=this.height;bufferCanvas.width=this.width;bufferCanvas.height=this.height;d()}};