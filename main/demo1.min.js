var gui,params;var pannel;var offsetX=20;var offsetY=20;var container3d;var camera,scene,renderer;var plane,cube;var mouse,raycaster,isShiftDown=false;var rollOverMesh,rollOverMaterial;var cubeGeo,cubeMaterial;var objects=[];var WIDTH_3D,HEIGHT_3D;initGUI();function initGUI(){if(!Detector.webgl){var a=Detector.getWebGLErrorMessage();alert(a);return}initDatUI();initPannel();init3d();onWindowResize();animate()}function initDatUI(){params={width:600,height:500,fullScreen:function(){fullscreen1(document.documentElement)},exitfullScreen:function(){exitFullscreen(document.documentElement)},hide3d:function(){container3d.style.visibility="hidden"},show3d:function(){container3d.style.visibility="visible"},resize:function(){onWindowResize()}};gui=new dat.gui.GUI({autoPlace:false});gui.add(params,"width").min(500).max(1902).step(10).listen();gui.add(params,"height").min(400).max(1080).step(10).listen();gui.add(params,"fullScreen");gui.add(params,"exitfullScreen");gui.add(params,"hide3d");gui.add(params,"show3d");gui.add(params,"resize");gui.domElement.id="gui";var a=document.getElementById("gui_container");a.appendChild(gui.domElement)}function fullscreen1(a){if(a.requestFullscreen){a.requestFullscreen()}else{if(a.mozRequestFullScreen){a.mozRequestFullScreen()}else{if(a.webkitRequestFullscreen){a.webkitRequestFullscreen()}else{if(a.msRequestFullscreen){a.msRequestFullscreen()}}}}}function exitFullscreen(){if(document.exitFullscreen){document.exitFullscreen()}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else{if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}}}function initPannel(){pannel=document.getElementById("panelCanvas");pannel.onmousedown=OnDown;pannel.onmouseup=OnUp;pannel.onmousemove=OnMove;drawPanelBG()}function drawPanelBG(){pannel=document.getElementById("panelCanvas");var b=pannel.getContext("2d");var a=b.createLinearGradient(0,0,0,250);a.addColorStop(0,"#000");a.addColorStop(1,"#fff");b.fillStyle=a;b.fillRect(0,0,500,250)}function OnDown(b){b.preventDefault();b.stopPropagation();clickOk=1;var c=parseInt(b.clientX-offsetX);var a=parseInt(b.clientY-offsetY);console.log("onDown  x="+c+",y="+a)}function OnUp(b){b.preventDefault();b.stopPropagation();clickOk=1;var c=parseInt(b.clientX-offsetX);var a=parseInt(b.clientY-offsetY);console.log("OnUp  x="+c+",y="+a)}function OnMove(b){b.preventDefault();b.stopPropagation();clickOk=1;var c=parseInt(b.clientX-offsetX);var a=parseInt(b.clientY-offsetY);console.log("OnMove  x="+c+",y="+a)}function init3d(){container3d=document.getElementById("screen3d");WIDTH_3D=container3d.clientWidth;HEIGHT_3D=container3d.clientHeight;camera=new THREE.PerspectiveCamera(50,WIDTH_3D/HEIGHT_3D,1,12000);camera.position.set(0,1000,1000);camera.lookAt(new THREE.Vector3());scene=new THREE.Scene();var j=new THREE.SphereGeometry(100000,25,25);var i=new THREE.TextureLoader(),k=i.load("../rs/skydome1.jpg");var e=new THREE.MeshPhongMaterial({map:k});var d=new THREE.Mesh(j,e);d.material.side=THREE.BackSide;var f=new THREE.AxisHelper(120);scene.add(f);var a=new THREE.BoxGeometry(50,50,50);rollOverMaterial=new THREE.MeshBasicMaterial({color:16711680,opacity:0.3,transparent:true});rollOverMesh=new THREE.Mesh(a,rollOverMaterial);scene.add(rollOverMesh);cubeGeo=new THREE.BoxGeometry(50,50,50);cubeMaterial=new THREE.MeshLambertMaterial({color:16693068,map:new THREE.TextureLoader().load("../rs/square-outline-textured.png")});var c=new THREE.GridHelper(1000,20);raycaster=new THREE.Raycaster();mouse=new THREE.Vector2();var h=new THREE.PlaneBufferGeometry(1000,1000);h.rotateX(-Math.PI/2);plane=new THREE.Mesh(h,new THREE.MeshBasicMaterial({visible:false}));scene.add(plane);objects.push(plane);var b=new THREE.AmbientLight(15790320);scene.add(b);var g=new THREE.DirectionalLight(16777215);g.position.set(1,0.75,0.5).normalize();scene.add(g);renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});renderer.setClearColor(0,0);renderer.setPixelRatio(window.devicePixelRatio);renderer.setSize(WIDTH_3D,HEIGHT_3D);container3d.appendChild(renderer.domElement);container3d.addEventListener("mousemove",onDocumentMouseMove,false);container3d.addEventListener("mousedown",onDocumentMouseDown,false);container3d.addEventListener("keydown",onDocumentKeyDown,false);container3d.addEventListener("keyup",onDocumentKeyUp,false);window.addEventListener("resize",onWindowResize,false)}function onWindowResize(){params.width=window.innerWidth;params.height=window.innerHeight;container3d=document.getElementById("screen3d");WIDTH_3D=container3d.clientWidth;HEIGHT_3D=container3d.clientHeight;camera.aspect=WIDTH_3D/HEIGHT_3D;camera.updateProjectionMatrix();renderer.setSize(WIDTH_3D,HEIGHT_3D);animate()}function onDocumentMouseMove(c){c.preventDefault();mouse.set(((c.clientX-offsetX)/WIDTH_3D)*2-1,-((c.clientY-offsetY)/HEIGHT_3D)*2+1);raycaster.setFromCamera(mouse,camera);var b=raycaster.intersectObjects(objects);if(b.length>0){var a=b[0];rollOverMesh.position.copy(a.point).add(a.face.normal);rollOverMesh.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25)}animate()}function onDocumentMouseDown(c){c.preventDefault();mouse.set(((c.clientX-offsetX)/WIDTH_3D)*2-1,-((c.clientY-offsetY)/HEIGHT_3D)*2+1);raycaster.setFromCamera(mouse,camera);var b=raycaster.intersectObjects(objects);if(b.length>0){var a=b[0];if(isShiftDown){if(a.object!=plane){scene.remove(a.object);objects.splice(objects.indexOf(a.object),1)}}else{var d=new THREE.Mesh(cubeGeo,cubeMaterial);d.position.copy(a.point).add(a.face.normal);d.position.divideScalar(50).floor().multiplyScalar(50).addScalar(25);scene.add(d);objects.push(d)}animate()}}function onDocumentKeyDown(a){switch(a.keyCode){case 16:isShiftDown=true;break}}function onDocumentKeyUp(a){switch(a.keyCode){case 16:isShiftDown=false;break}}function animate(){renderer.render(scene,camera)};