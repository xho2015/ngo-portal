<project name="NGO.km Ant Deployment Utility" default="ngoEcho" basedir=".">

	<property file="build.properties" />

	<path id="catalina-ant-classpath">
		<fileset dir="${tomcat.home}/lib">
			<include name="catalina-ant.jar" />
			<include name="tomcat-coyote.jar" />
			<include name="tomcat-util.jar" />
		</fileset>
		<fileset dir="${tomcat.home}/bin">
			<include name="tomcat-juli.jar" />
		</fileset>
	</path>
	<taskdef file="${project.root}/util/ant/tomcatTasks.properties">
		<classpath refid="catalina-ant-classpath" />
	</taskdef>


	<path id="ngo-ant-classpath">
		<fileset dir="${project.root}/util/ant/lib">
			<include name="ngotask.jar" />
		</fileset>
		<fileset dir="${project.root}/util/jsc">
			<include name="yuicompressor-2.4.8.jar" />
			<include name="commons-io-2.5.jar" />
		</fileset>
		<fileset dir="${project.root}/util/gzip">
			<include name="commons-compress-1.14.jar" />
		</fileset>
		<fileset dir="${project.root}/util/md5">
			<include name="commons-codec-1.10.jar" />
		</fileset>
	</path>
	<taskdef file="${project.root}/util/ant/ngoTasks.properties">
		<classpath refid="ngo-ant-classpath" />
	</taskdef>

	<!--default-->
	<target name="ngoEcho">
		<echo message="${project.name} ${project.ver},  basedir=${basedir}, project.root=${project.root}" />
	</target>


	<!-- basic targets -->
	<target name="clean">
		<delete dir="${dest.dir}" />
	</target>


	<target name="war" description="build war" depends="clean">
		<mkdir dir="${dist.dir}" />
		<war destfile="${dist.dir}/ROOT.war" webxml="${project.root}/WEB-INF/web.xml">
			<classes dir="${project.root}/WEB-INF/classes" />
			<fileset dir="${project.root}">
				<exclude name="WEB-INF/web.xml" />
				<exclude name="WEB-INF/classes/**" />
				<exclude name="WEB-INF/lib/**" />
				<exclude name="WEB-INF/src/**" />
				<exclude name="**/*.js" />
				<exclude name="doc/**" />
				<exclude name="util/**" />
			</fileset>
			<lib dir="${project.root}/WEB-INF/lib" />
		</war>
	</target>

	<!-- NGO resource package -->
	<target name="jsConfusion" description="Javascript Confusion">
		<confusion ignore="\app\lib\dat.gui.js|\app\lib\three.js" include=".*\.js" exclude=".*\.min\.js" fileExtension="min.js" path="${project.root}" />
	</target>

	<target name="jsGzip" description="Confusion and Gzip for javascript " depends="jsConfusion">
		<ngzip include=".*\.min\.js" exclude="__NOMATCH__" fileExtension="ngjs" path="${project.root}" />
	</target>
	
	<target name="cssGzip" description="Gzip for css">
			<ngzip include=".*\.css" exclude="__NOMATCH__" fileExtension="ngcss" path="${project.root}" />
		</target>

	<!--This task is only for DEV debug purpose only-->
	<target name="jsGzip-DEV" description="Javascript Gzip with raw javascript">
		<ngzip include=".*\.js" exclude=".*\.min\.js" fileExtension="min.ngjs" path="${project.root}" />
	</target>

	<!--new NG resouce needs to be registered in include-->
	<target name="ngoMd5" description="generate md5 checksum for NGO resource and dump to file">
		<ngmd5 include=".*\.ng(js|css)" exclude="__NOMATCH__" bomRoot="/bom/" outFile="/bom/ngo.bom" path="${project.root}"  spliter="|"/>
	</target>


	<!-- NGO web manager interface -->


	<!-- Tomcat manager interface -->
	<target name="deploy" description="Install web application" depends="">
		<deploy url="${url}" username="${username}" password="${password}" path="${path}" war="${dist.dir}/ROOT.war" />
	</target>

	<target name="reload" description="Reload web application" depends="">
		<reload url="${url}" username="${username}" password="${password}" path="${path}" />
	</target>

	<target name="undeploy" description="Remove web application">
		<undeploy url="${url}" username="${username}" password="${password}" path="${path}" />
	</target>


</project>